<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Apache Kafka Connector | StreamX</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="alternate" type="application/atom+xml" href="http://www.streamxhub.com/atom.xml" title="StreamX Atom Feed">
    <link rel="alternate" type="application/json" href="http://www.streamxhub.com/feed.json" title="StreamX JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="http://www.streamxhub.com/rss.xml" title="StreamX RSS Feed">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="StreamX 是一个 Apache Flink&Spark 极速开发框架,项目的初衷是 ——让 Flink&Spark 更简单。其定位是 Flink&Spark 开发脚手架 + 流批一体大数据平台,一站式大数据平台,Flink大数据平台,Flink可视化数据平台,LowCode平台,流批一体,一站式,Flink,Spark,FlinkSQL,Application,sqlSubmit,SpringBoot,Vue,flink-connectors">
    <meta property="og:url" content="/doc/connector/kafka.html">
    <meta property="og:site_name" content="StreamX">
    <meta property="og:title" content="Apache Kafka Connector">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta property="og:locale:alternate" content="zh-CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="StreamX">
    <meta property="article:author" content="benjobs">
    <meta property="article:published_time" content="2020-03-20T00:00:00.000Z">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.e61378b1.css" as="style"><link rel="preload" href="/assets/js/app.22cf09d4.js" as="script"><link rel="preload" href="/assets/js/layout-Layout.becd9ee4.js" as="script"><link rel="preload" href="/assets/js/layout-Blog~layout-Layout~layout-NotFound.3c755216.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.196cd7eb.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.d4d9fba5.js" as="script"><link rel="preload" href="/assets/js/page-ApacheKafkaConnector.446746a8.js" as="script"><link rel="prefetch" href="/assets/js/42.a059c770.js"><link rel="prefetch" href="/assets/js/43.23aa9fe9.js"><link rel="prefetch" href="/assets/js/44.461f784d.js"><link rel="prefetch" href="/assets/js/45.9f7881a9.js"><link rel="prefetch" href="/assets/js/46.33683b10.js"><link rel="prefetch" href="/assets/js/47.a525ada9.js"><link rel="prefetch" href="/assets/js/layout-Blog.0402a712.js"><link rel="prefetch" href="/assets/js/layout-NotFound.79a4b79f.js"><link rel="prefetch" href="/assets/js/layout-Slide.2f19a4c0.js"><link rel="prefetch" href="/assets/js/page--1b6a62f8.067ad2ab.js"><link rel="prefetch" href="/assets/js/page--2c4c091a.7e4aaf61.js"><link rel="prefetch" href="/assets/js/page--3c555584.fcf5e850.js"><link rel="prefetch" href="/assets/js/page--409acd44.e7433c70.js"><link rel="prefetch" href="/assets/js/page--4f5a453e.40f14e98.js"><link rel="prefetch" href="/assets/js/page--539c1ce4.d141a9e5.js"><link rel="prefetch" href="/assets/js/page-ClickhouseConnector.3c2ff7f8.js"><link rel="prefetch" href="/assets/js/page-Document.77571c8f.js"><link rel="prefetch" href="/assets/js/page-ElasticsearchConnector.ce7ae99d.js"><link rel="prefetch" href="/assets/js/page-FlinkK8s集成支持.3429c67b.js"><link rel="prefetch" href="/assets/js/page-FlinkKubernetesIntegration.55703ebb.js"><link rel="prefetch" href="/assets/js/page-FlinkSQL.a314fae0.js"><link rel="prefetch" href="/assets/js/page-HadoopResourceIntegration.8d80e04c.js"><link rel="prefetch" href="/assets/js/page-Hadoop资源集成.baef36a9.js"><link rel="prefetch" href="/assets/js/page-HttpConnector.5bf8e46e.js"><link rel="prefetch" href="/assets/js/page-JdbcConnector.7f5889ba.js"><link rel="prefetch" href="/assets/js/page-K8sPVCUsage.6caa3bf0.js"><link rel="prefetch" href="/assets/js/page-K8sPVC资源使用.112bc8c0.js"><link rel="prefetch" href="/assets/js/page-MongoDbConnector.b0cedbab.js"><link rel="prefetch" href="/assets/js/page-RedisConnector.cfc52f7d.js"><link rel="prefetch" href="/assets/js/page-安装部署.b8e915fe.js"><link rel="prefetch" href="/assets/js/page-开发实例.0980ec05.js"><link rel="prefetch" href="/assets/js/page-开发环境.691a790e.js"><link rel="prefetch" href="/assets/js/page-快速开始.53f1f26c.js"><link rel="prefetch" href="/assets/js/page-文档中心.518a90ac.js"><link rel="prefetch" href="/assets/js/page-框架介绍.0ac0772a.js"><link rel="prefetch" href="/assets/js/page-编程模型.6793b96f.js"><link rel="prefetch" href="/assets/js/page-项目配置.96db4490.js"><link rel="prefetch" href="/assets/js/page-高级扩展.1c819932.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.6d4ac09b.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.50b043d6.js"><link rel="prefetch" href="/assets/js/vendors~reveal.0dae242e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e61378b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><button class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/assets/logo/streamx.png" alt="StreamX" class="logo"> <!----></a> <div class="links"><!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><!---->
  Home
</a></div><div class="nav-item"><a href="/doc/" class="nav-link router-link-active active"><!---->
  Document
</a></div><div class="nav-item"><a href="/sponsor/" class="nav-link"><!---->
  Sponsor
</a></div><div class="nav-item"><a href="/download/" class="nav-link"><!---->
  Download
</a></div></nav> <div class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" style="width:1rem;height:1rem;vertical-align:middle;margin-left:1rem;"><path d="M639.981 344.075c14.805 44.45 34.542 79.023 69.084 113.596 29.603-29.634 49.34-69.146 64.145-113.596H639.981zM314.33 591.024h128.29l-64.145-172.865-64.145 172.865z" fill="currentColor"></path> <path d="M807.746 116.882H215.643c-54.274 0-98.681 44.45-98.681 98.78v592.677c0 54.329 44.407 98.78 98.68 98.78h592.104c54.273 0 98.681-44.451 98.681-98.78V215.66c0-54.329-39.475-98.78-98.68-98.78zM565.971 754.01c-9.866 9.878-19.738 9.878-29.603 9.878-4.94 0-14.805 0-19.738-4.939-4.939-4.939-9.872 0-9.872-4.939s-4.932-9.878-9.865-19.756c-4.94-9.878-4.94-14.817-9.872-24.695L467.29 655.23H294.592l-19.737 54.33c-9.866 19.755-14.805 34.572-19.738 44.45-4.939 9.878-14.804 9.878-29.603 9.878-9.871 0-19.737-4.939-29.609-9.878-9.865-9.878-14.798-14.817-14.798-24.695 0-4.939 0-9.878 4.933-19.756 4.939-9.878 4.939-14.817 9.865-24.695l108.553-276.583c4.939-9.878 4.939-19.756 9.872-29.633 4.932-9.878 9.865-19.756 14.798-24.695 4.939-4.94 9.872-14.817 19.737-19.756 9.872-4.94 19.738-4.94 29.61-4.94 9.865 0 19.73 0 29.603 4.94 9.865 4.939 14.804 9.878 19.737 19.756 4.933 4.939 9.866 14.817 14.798 24.695 4.94 9.877 9.872 19.755 14.805 34.572l108.553 271.644c9.865 19.756 14.804 34.573 14.804 44.451-4.939 4.94-9.872 14.817-14.804 24.695zm271.378-192.62c-54.273-19.756-93.748-44.451-128.29-74.085-34.536 34.573-78.943 59.268-133.223 74.085l-14.798-24.695c54.273-14.817 98.68-34.573 133.223-69.146-34.542-34.573-64.145-79.024-74.017-128.413h-49.34V319.38h133.228c-9.877-14.817-19.743-34.573-29.609-49.39l14.799-4.94c9.871 14.818 24.676 34.574 34.542 54.33h123.35v24.695h-49.34c-14.798 49.39-39.468 93.84-69.077 123.474 34.541 29.634 74.01 54.329 128.29 69.146l-19.738 24.695z" fill="currentColor"></path></svg> <span class="arrow down"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/doc/connector/kafka/" aria-current="page" class="nav-link router-link-exact-active router-link-active active"><!---->
  English
</a></li><li class="dropdown-item"><a href="/zh/doc/connector/kafka/" class="nav-link"><!---->
  简体中文
</a></li></ul></div></div></div> <a rel="noopener noreferrer" href="https://github.com/streamxhub/streamx" target="_blank" class="repo-link can-hide">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><!---->
  Home
</a></div><div class="nav-item"><a href="/doc/" class="nav-link router-link-active active"><!---->
  Document
</a></div><div class="nav-item"><a href="/sponsor/" class="nav-link"><!---->
  Sponsor
</a></div><div class="nav-item"><a href="/download/" class="nav-link"><!---->
  Download
</a></div> <a rel="noopener noreferrer" href="https://github.com/streamxhub/streamx" target="_blank" class="repo-link">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">QuickStart</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/guide/intro/" class="sidebar-link">框架介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/guide/intro/#🚀-什么是streamx" class="sidebar-link">🚀 什么是StreamX</a></li><li class="sidebar-sub-header"><a href="/doc/guide/intro/#🎉-features" class="sidebar-link">🎉 Features</a></li><li class="sidebar-sub-header"><a href="/doc/guide/intro/#🏳‍🌈-组成部分" class="sidebar-link">🏳‍🌈 组成部分</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/guide/intro/#_1️⃣-streamx-core" class="sidebar-link heading3">1️⃣ streamx-core</a></li><li class="sidebar-sub-header"><a href="/doc/guide/intro/#_2️⃣-streamx-pump" class="sidebar-link heading3">2️⃣ streamx-pump</a></li><li class="sidebar-sub-header"><a href="/doc/guide/intro/#_3️⃣-streamx-console" class="sidebar-link heading3">3️⃣ streamx-console</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/guide/intro/#👻-为什么不是-❓" class="sidebar-link">👻 为什么不是...❓</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/guide/intro/#apache-zeppelin" class="sidebar-link heading3">Apache Zeppelin</a></li><li class="sidebar-sub-header"><a href="/doc/guide/intro/#flinkx" class="sidebar-link heading3">FlinkX</a></li></ul></li></ul></li><li><a href="/doc/guide/quickstart/" class="sidebar-link">快速开始</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/guide/quickstart/#起步" class="sidebar-link">起步</a></li><li class="sidebar-sub-header"><a href="/doc/guide/quickstart/#datastream" class="sidebar-link">DataStream</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/guide/quickstart/#编码开发" class="sidebar-link heading3">编码开发</a></li><li class="sidebar-sub-header"><a href="/doc/guide/quickstart/#配置文件" class="sidebar-link heading3">配置文件</a></li><li class="sidebar-sub-header"><a href="/doc/guide/quickstart/#本地测试" class="sidebar-link heading3">本地测试</a></li><li class="sidebar-sub-header"><a href="/doc/guide/quickstart/#部署上线" class="sidebar-link heading3">部署上线</a></li><li class="sidebar-sub-header"><a href="/doc/guide/quickstart/#项目结构" class="sidebar-link heading3">项目结构</a></li><li class="sidebar-sub-header"><a href="/doc/guide/quickstart/#启动命令" class="sidebar-link heading3">启动命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/guide/quickstart/#flink-sql" class="sidebar-link">Flink Sql</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/guide/quickstart/#编码开发-2" class="sidebar-link heading3">编码开发</a></li><li class="sidebar-sub-header"><a href="/doc/guide/quickstart/#配置文件-2" class="sidebar-link heading3">配置文件</a></li><li class="sidebar-sub-header"><a href="/doc/guide/quickstart/#本地测试-2" class="sidebar-link heading3">本地测试</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">规范约定</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/model/conf/" class="sidebar-link">项目配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/model/conf/#为什么需要配置" class="sidebar-link">为什么需要配置</a></li><li class="sidebar-sub-header"><a href="/doc/model/conf/#相关术语" class="sidebar-link">相关术语</a></li><li class="sidebar-sub-header"><a href="/doc/model/conf/#配置文件" class="sidebar-link">配置文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/model/conf/#deployment" class="sidebar-link heading3">Deployment</a></li><li class="sidebar-sub-header"><a href="/doc/model/conf/#checkpoints" class="sidebar-link heading3">Checkpoints</a></li><li class="sidebar-sub-header"><a href="/doc/model/conf/#watermark" class="sidebar-link heading3">Watermark</a></li><li class="sidebar-sub-header"><a href="/doc/model/conf/#state" class="sidebar-link heading3">State</a></li><li class="sidebar-sub-header"><a href="/doc/model/conf/#restart-strategy" class="sidebar-link heading3">Restart Strategy</a></li><li class="sidebar-sub-header"><a href="/doc/model/conf/#table" class="sidebar-link heading3">Table</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/model/conf/#sql-文件" class="sidebar-link">Sql 文件</a></li><li class="sidebar-sub-header"><a href="/doc/model/conf/#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/doc/model/model/" class="sidebar-link">编程模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/model/model/#架构" class="sidebar-link">架构</a></li><li class="sidebar-sub-header"><a href="/doc/model/model/#编程模型" class="sidebar-link">编程模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/model/model/#datastream" class="sidebar-link heading3">DataStream</a></li><li class="sidebar-sub-header"><a href="/doc/model/model/#flink-sql" class="sidebar-link heading3">Flink SQL</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/model/model/#runtime-context" class="sidebar-link">RunTime Context</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/model/model/#streamingcontext" class="sidebar-link heading3">StreamingContext</a></li><li class="sidebar-sub-header"><a href="/doc/model/model/#tablecontext" class="sidebar-link heading3">TableContext</a></li><li class="sidebar-sub-header"><a href="/doc/model/model/#streamtablecontext" class="sidebar-link heading3">StreamTableContext</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/model/model/#生命周期" class="sidebar-link">生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/model/model/#生命周期之-init" class="sidebar-link heading3">生命周期之—— init</a></li><li class="sidebar-sub-header"><a href="/doc/model/model/#生命周期之-config" class="sidebar-link heading3">生命周期之—— config</a></li><li class="sidebar-sub-header"><a href="/doc/model/model/#生命周期之-ready" class="sidebar-link heading3">生命周期之—— ready</a></li><li class="sidebar-sub-header"><a href="/doc/model/model/#生命周期之-handle" class="sidebar-link heading3">生命周期之—— handle</a></li><li class="sidebar-sub-header"><a href="/doc/model/model/#生命周期之-start" class="sidebar-link heading3">生命周期之—— start</a></li><li class="sidebar-sub-header"><a href="/doc/model/model/#生命周期之-destroy" class="sidebar-link heading3">生命周期之—— destroy</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/model/model/#目录结构" class="sidebar-link">目录结构</a></li><li class="sidebar-sub-header"><a href="/doc/model/model/#打包部署" class="sidebar-link">打包部署</a></li><li class="sidebar-sub-header"><a href="/doc/model/model/#启动命令" class="sidebar-link">启动命令</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">DataStream Connectors</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/connector/kafka/" aria-current="page" class="active sidebar-link">Apache Kafka Connector</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#依赖" class="sidebar-link">依赖</a></li><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#kafka-source-consumer" class="sidebar-link">Kafka Source (Consumer)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#基础消费示例" class="sidebar-link heading3">基础消费示例</a></li><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#高级配置参数" class="sidebar-link heading3">高级配置参数</a></li><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#消费多个kafka实例" class="sidebar-link heading3">消费多个Kafka实例</a></li><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#消费多个topic" class="sidebar-link heading3">消费多个Topic</a></li><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#topic-发现" class="sidebar-link heading3">Topic 发现</a></li><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#配置开始消费的位置" class="sidebar-link heading3">配置开始消费的位置</a></li><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#指定分区offset" class="sidebar-link heading3">指定分区Offset</a></li><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#指定deserializer" class="sidebar-link heading3">指定deserializer</a></li><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#返回记录kafkarecord" class="sidebar-link heading3">返回记录KafkaRecord</a></li><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#指定strategy" class="sidebar-link heading3">指定strategy</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#kafka-sink-producer" class="sidebar-link">Kafka Sink (Producer)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#容错和语义" class="sidebar-link heading3">容错和语义</a></li><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#多实例kafka指定alias" class="sidebar-link heading3">多实例kafka指定alias</a></li><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#指定serializationschema" class="sidebar-link heading3">指定SerializationSchema</a></li><li class="sidebar-sub-header"><a href="/doc/connector/kafka/#指定partitioner" class="sidebar-link heading3">指定partitioner</a></li></ul></li></ul></li><li><a href="/doc/connector/jdbc/" class="sidebar-link">Jdbc Connector</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/connector/jdbc/#jdbc-信息配置" class="sidebar-link">Jdbc 信息配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/connector/jdbc/#semantic-语义配置" class="sidebar-link heading3">semantic 语义配置</a></li><li class="sidebar-sub-header"><a href="/doc/connector/jdbc/#其他配置" class="sidebar-link heading3">其他配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/connector/jdbc/#jdbc-读取数据" class="sidebar-link">Jdbc 读取数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/connector/jdbc/#queryfunc获取一条sql" class="sidebar-link heading3">queryFunc获取一条sql</a></li><li class="sidebar-sub-header"><a href="/doc/connector/jdbc/#resultfunc-处理查询到的数据" class="sidebar-link heading3">resultFunc 处理查询到的数据</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/connector/jdbc/#jdbc-读取写入" class="sidebar-link">Jdbc 读取写入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/connector/jdbc/#根据数据流生成目标sql" class="sidebar-link heading3">根据数据流生成目标SQL</a></li><li class="sidebar-sub-header"><a href="/doc/connector/jdbc/#设置写入批次大小" class="sidebar-link heading3">设置写入批次大小</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/connector/jdbc/#多实例jdbc支持" class="sidebar-link">多实例Jdbc支持</a></li><li class="sidebar-sub-header"><a href="/doc/connector/jdbc/#手动指定jdbc连接信息" class="sidebar-link">手动指定Jdbc连接信息</a></li></ul></li><li><a href="/doc/connector/redis/" class="sidebar-link">Redis Connector</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/doc/connector/mongo/" class="sidebar-link">MongoDb Connector</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/doc/connector/clickhouse/" class="sidebar-link">Clickhouse Connector</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/doc/connector/http/" class="sidebar-link">Http Connector</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/doc/connector/es/" class="sidebar-link">Elasticsearch Connector</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">Flink SQL Connectors</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/flinksql/flinksql/" class="sidebar-link">Flink SQL</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">高级扩展</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/advanced/advanced/" class="sidebar-link">高级扩展</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">StreamX Console</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/console/deploy/" class="sidebar-link">安装部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/console/deploy/#环境要求" class="sidebar-link">环境要求</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/console/deploy/#hadoop" class="sidebar-link heading3">Hadoop</a></li><li class="sidebar-sub-header"><a href="/doc/console/deploy/#kubernetes" class="sidebar-link heading3">Kubernetes</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/console/deploy/#编译-安装" class="sidebar-link">编译 &amp; 安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/console/deploy/#编译" class="sidebar-link heading3">编译</a></li><li class="sidebar-sub-header"><a href="/doc/console/deploy/#修改配置" class="sidebar-link heading3">修改配置</a></li><li class="sidebar-sub-header"><a href="/doc/console/deploy/#启动" class="sidebar-link heading3">启动</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/console/deploy/#系统配置" class="sidebar-link">系统配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/console/deploy/#flink-home" class="sidebar-link heading3">Flink Home</a></li><li class="sidebar-sub-header"><a href="/doc/console/deploy/#maven-home" class="sidebar-link heading3">Maven Home</a></li><li class="sidebar-sub-header"><a href="/doc/console/deploy/#streamx-env" class="sidebar-link heading3">StreamX Env</a></li><li class="sidebar-sub-header"><a href="/doc/console/deploy/#email" class="sidebar-link heading3">Email</a></li></ul></li></ul></li><li><a href="/doc/console/quickstart/" class="sidebar-link">快速开始</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/console/quickstart/#如何使用" class="sidebar-link">如何使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/console/quickstart/#部署-datastream-任务" class="sidebar-link heading3">部署 DataStream 任务</a></li><li class="sidebar-sub-header"><a href="/doc/console/quickstart/#部署-flinksql-任务" class="sidebar-link heading3">部署 FlinkSql 任务</a></li><li class="sidebar-sub-header"><a href="/doc/console/quickstart/#任务启动流程" class="sidebar-link heading3">任务启动流程</a></li></ul></li></ul></li><li><a href="/doc/console/deployment/" class="sidebar-link">开发环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/console/deployment/#安装-hadoop-可选-yarn-runtime" class="sidebar-link">安装 Hadoop（可选，YARN Runtime）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/console/deployment/#本地安装-hadoop-环境" class="sidebar-link heading3">本地安装 Hadoop 环境</a></li><li class="sidebar-sub-header"><a href="/doc/console/deployment/#使用已有-hadoop-集群" class="sidebar-link heading3">使用已有 Hadoop 集群</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/console/deployment/#安装-kubernetes-可选-k8s-runtime" class="sidebar-link">安装 Kubernetes （可选，K8s Runtime）</a></li><li class="sidebar-sub-header"><a href="/doc/console/deployment/#安装-flink-可选-standalone-runtime" class="sidebar-link">安装 Flink（可选，Standalone Runtime）</a></li><li class="sidebar-sub-header"><a href="/doc/console/deployment/#安装-maven" class="sidebar-link">安装 Maven</a></li><li class="sidebar-sub-header"><a href="/doc/console/deployment/#安装-mysql" class="sidebar-link">安装 MySQL</a></li><li class="sidebar-sub-header"><a href="/doc/console/deployment/#安装-nodejs" class="sidebar-link">安装 Nodejs</a></li><li class="sidebar-sub-header"><a href="/doc/console/deployment/#安装配置-streamx" class="sidebar-link">安装配置 StreamX</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/console/deployment/#后端" class="sidebar-link heading3">后端</a></li><li class="sidebar-sub-header"><a href="/doc/console/deployment/#前端" class="sidebar-link heading3">前端</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">Deployment</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><!----> <span class="title">Flink Kubernetes</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/flink-k8s/1-deployment/" class="sidebar-link">Flink Kubernetes Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/flink-k8s/1-deployment/#additional-software-environment" class="sidebar-link">Additional Software Environment</a></li><li class="sidebar-sub-header"><a href="/doc/flink-k8s/1-deployment/#deployment-preparation" class="sidebar-link">Deployment Preparation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/flink-k8s/1-deployment/#kubernetes-access" class="sidebar-link heading3">Kubernetes Access</a></li><li class="sidebar-sub-header"><a href="/doc/flink-k8s/1-deployment/#kubernetes-rbac" class="sidebar-link heading3">Kubernetes RBAC</a></li><li class="sidebar-sub-header"><a href="/doc/flink-k8s/1-deployment/#remote-docker-register-service" class="sidebar-link heading3">Remote Docker Register Service</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/flink-k8s/1-deployment/#flink-job-submission" class="sidebar-link">Flink Job Submission</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/flink-k8s/1-deployment/#flink-application-job" class="sidebar-link heading3">Flink-Application Job</a></li><li class="sidebar-sub-header"><a href="/doc/flink-k8s/1-deployment/#flink-session-job" class="sidebar-link heading3">Flink-Session Job</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/flink-k8s/1-deployment/#related-configuration" class="sidebar-link">Related Configuration</a></li></ul></li><li><a href="/doc/flink-k8s/2-k8s-pvc-integration/" class="sidebar-link">K8s PVC Usage</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/flink-k8s/2-k8s-pvc-integration/#k8s-pvc-resource-usage" class="sidebar-link">K8s PVC Resource Usage</a></li></ul></li><li><a href="/doc/flink-k8s/3-hadoop-resource-integration/" class="sidebar-link">Hadoop Resource Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/flink-k8s/3-hadoop-resource-integration/#hadoop-resource-integration" class="sidebar-link">Hadoop Resource Integration</a></li></ul></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/doc/" property="item" typeof="WebPage" class="router-link-active"><i class="iconfont home"></i> <span property="name">Document</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/doc/connector/kafka/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">Apache Kafka Connector</span></a> <meta property="position" content="2"></li></ol></nav>  <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">Apache Kafka Connector</span></h1> <div class="page-info"><span class="origin">Original💡</span> <span aria-label="Author🖊" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">benjobs</span></span><!----><span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2020/03/20</span></span><!----><!----><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 17 min</span> <meta property="timeRequired" content="PT17M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/doc/connector/kafka/#依赖" class="anchor-link heading2"><div>依赖</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#kafka-source-consumer" class="anchor-link heading2"><div>Kafka Source (Consumer)</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#基础消费示例" class="anchor-link heading3"><div>基础消费示例</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#高级配置参数" class="anchor-link heading3"><div>高级配置参数</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#消费多个kafka实例" class="anchor-link heading3"><div>消费多个Kafka实例</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#消费多个topic" class="anchor-link heading3"><div>消费多个Topic</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#topic-发现" class="anchor-link heading3"><div>Topic 发现</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#配置开始消费的位置" class="anchor-link heading3"><div>配置开始消费的位置</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#指定分区offset" class="anchor-link heading3"><div>指定分区Offset</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#指定deserializer" class="anchor-link heading3"><div>指定deserializer</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#返回记录kafkarecord" class="anchor-link heading3"><div>返回记录KafkaRecord</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#指定strategy" class="anchor-link heading3"><div>指定strategy</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#kafka-sink-producer" class="anchor-link heading2"><div>Kafka Sink (Producer)</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#容错和语义" class="anchor-link heading3"><div>容错和语义</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#多实例kafka指定alias" class="anchor-link heading3"><div>多实例kafka指定alias</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#指定serializationschema" class="anchor-link heading3"><div>指定SerializationSchema</div></a></li><li class="anchor"><a href="/doc/connector/kafka/#指定partitioner" class="anchor-link heading3"><div>指定partitioner</div></a></li></ul></div></aside></div> <div class="theme-default-content content__default"><p><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kafka.html" target="_blank" rel="noopener noreferrer">Flink 官方<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>提供了<a href="http://kafka.apache.org" target="_blank" rel="noopener noreferrer">Apache Kafka<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的连接器,用于从 Kafka topic 中读取或者向其中写入数据,可提供 <mark>精确一次</mark> 的处理语义</p> <p><code>StreamX</code>中<code>KafkaSource</code>和<code>KafkaSink</code>基于官网的<code>kafka connector</code>进一步封装,屏蔽很多细节,简化开发步骤,让数据的读取和写入更简单</p> <h2 id="依赖"><a href="#依赖" class="header-anchor">#</a> 依赖</h2> <p><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kafka.html" target="_blank" rel="noopener noreferrer">Apache Flink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 集成了通用的 Kafka 连接器，它会尽力与 Kafka client 的最新版本保持同步。该连接器使用的 Kafka client 版本可能会在 Flink 版本之间发生变化。 当前 Kafka client 向后兼容 0.10.0 或更高版本的 Kafka broker。 有关 Kafka 兼容性的更多细节，请参考 <a href="https://kafka.apache.org/protocol.html#protocol_compatibility" target="_blank" rel="noopener noreferrer">Kafka<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 官方文档。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token comment">&lt;!--必须要导入的依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.streamxhub.streamx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>Streamx-flink-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--flink-connector--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-kafka_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.12.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>同时在开发阶段,以下的依赖也是必要的</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token comment">&lt;!--以下scope为provided的依赖也是必须要导入的--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-scala_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-clients_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-streaming-scala_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="kafka-source-consumer"><a href="#kafka-source-consumer" class="header-anchor">#</a> Kafka Source (Consumer)</h2> <p>先介绍基于官网的标准的kafka consumer的方式,以下代码摘自<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kafka.html#kafka-consumer" target="_blank" rel="noopener noreferrer">官网文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> Properties<span class="token punctuation">(</span><span class="token punctuation">)</span>
properties<span class="token punctuation">.</span>setProperty<span class="token punctuation">(</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost:9092&quot;</span><span class="token punctuation">)</span>
properties<span class="token punctuation">.</span>setProperty<span class="token punctuation">(</span><span class="token string">&quot;group.id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span>addSource<span class="token punctuation">(</span><span class="token keyword">new</span> FlinkKafkaConsumer<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;topic&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> SimpleStringSchema<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> properties<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>可以看到一上来定义了一堆kafka的连接信息,这种方式各项参数都是硬编码的方式写死的,非常的不灵敏,下面我们来看看如何用<code>StreamX</code>接入 <code>kafka</code>的数据,只需要按照规定的格式定义好配置文件然后编写代码即可,配置和代码如下</p> <h3 id="基础消费示例"><a href="#基础消费示例" class="header-anchor">#</a> 基础消费示例</h3> <!----> <h3 id="高级配置参数"><a href="#高级配置参数" class="header-anchor">#</a> 高级配置参数</h3> <p><code>KafkaSource</code>是基于Flink Kafka Connector封装一个更简单的kafka读取类,构造方法里需要传入<code>StreamingContext</code>,当程序启动时传入配置文件即可,框架会自动解析配置文件,在<code>new KafkaSource</code>的时候会自动的从配置文件中获取相关信息,初始化并返回一个Kafka Consumer,在这里topic下只配置了一个topic,因此在消费的时候不用指定topic直接默认获取这个topic来消费, 这只是一个最简单的例子,更多更复杂的规则和读取操作则要通过<code>.getDataStream()</code>在该方法里传入参数才能实现
我们看看<code>getDataStream</code>这个方法的签名</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> getDataStream<span class="token punctuation">[</span>T<span class="token operator">:</span> TypeInformation<span class="token punctuation">]</span><span class="token punctuation">(</span>topic<span class="token operator">:</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    alias<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    deserializer<span class="token operator">:</span> KafkaDeserializationSchema<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">,</span>
    strategy<span class="token operator">:</span> WatermarkStrategy<span class="token punctuation">[</span>KafkaRecord<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">)</span><span class="token operator">:</span> DataStream<span class="token punctuation">[</span>KafkaRecord<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数具体作用如下</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">参数类型</th> <th style="text-align:left;">作用</th> <th style="text-align:left;">默认值</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>topic</code></td> <td style="text-align:left;">Serializable</td> <td style="text-align:left;">一个topic或者一组topic</td> <td style="text-align:left;">无</td></tr> <tr><td style="text-align:left;"><code>alias</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">用于区别不同的kafka实例</td> <td style="text-align:left;">无</td></tr> <tr><td style="text-align:left;"><code>deserializer</code></td> <td style="text-align:left;">DeserializationSchema</td> <td style="text-align:left;">topic里数据的具体解析类</td> <td style="text-align:left;">KafkaStringDeserializationSchema</td></tr> <tr><td style="text-align:left;"><code>strategy</code></td> <td style="text-align:left;">WatermarkStrategy</td> <td style="text-align:left;">watermark生成策略</td> <td style="text-align:left;">无</td></tr></tbody></table> <p>下面我们来看看更多的使用和配置方式</p> <div class="counter"><ul><li>消费多个Kafka实例</li> <li>消费多个Topic</li> <li>Topic动态发现</li> <li>从指定Offset消费</li> <li>指定KafkaDeserializationSchema</li> <li>指定WatermarkStrategy</li></ul></div> <h3 id="消费多个kafka实例"><a href="#消费多个kafka实例" class="header-anchor">#</a> 消费多个Kafka实例</h3> <p>在框架开发之初就考虑到了多个不同实例的kafka的配置情况.如何来统一配置,并且规范格式呢?在streamx中是这么解决的,假如我们要同时消费两个不同实例的kafka,配置文件定义如下,
可以看到在<code>kafka.source</code>下直接放kafka的实例名称(名字可以任意),在这里我们统一称为 <mark><code>alias</code></mark> , <mark><code>alias</code></mark> 必须是唯一的,来区别不同的实例,然后别的参数还是按照之前的规范,
统统放到当前这个实例的namespace下即可.如果只有一个kafka实例,则可以不用配置<code>alias</code>
在写代码消费时注意指定对应的 <mark><code>alias</code></mark> 即可,配置和代码如下</p> <!----> <h3 id="消费多个topic"><a href="#消费多个topic" class="header-anchor">#</a> 消费多个Topic</h3> <p>配置消费多个topic也很简单,在配置文件<code>topic</code>下配置多个topic名称即可,用<code>,</code>或空格分隔,代码消费处理的时候指定topic参数即可,<code>scala</code> api下如果是消费一个topic,则直接传入topic名称即可,如果要消费多个,传入一个<code>List</code>即可
<code>java</code>api通过 <code>topic()</code>方法传入要消费topic的名称,是一个String类型的可变参数,可以传入一个或多个<code>topic</code>名称,配置和代码如下</p> <!----> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p><code>topic</code>支持配置多个<code>topic</code>实例,每个<code>topic</code>直接用<code>,</code>分隔或者空格分隔,如果topic下配置多个实例,在消费的时必须指定具体的topic名称</p></div> <h3 id="topic-发现"><a href="#topic-发现" class="header-anchor">#</a> Topic 发现</h3> <p>关于kafka的分区动态,默认情况下，是禁用了分区发现的。若要启用它，请在提供的属性配置中为 <code>flink.partition-discovery.interval-millis</code> 设置大于 <code>0</code>,表示发现分区的间隔是以毫秒为单位的
更多详情请参考<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/dev/connectors/kafka.html#partition-discovery" target="_blank" rel="noopener noreferrer">官网文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Flink Kafka Consumer 还能够使用正则表达式基于 Topic 名称的模式匹配来发现 Topic,详情请参考<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/dev/connectors/kafka.html#topic-discovery" target="_blank" rel="noopener noreferrer">官网文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
在<code>StreamX</code>中提供更简单的方式,具体需要在 <code>pattern</code>下配置要匹配的<code>topic</code>实例名称的正则即可</p> <!----> <div class="custom-block danger"><p class="custom-block-title">特别注意</p> <p><code>topic</code>和<code>pattern</code>不能同时配置,当配置了<code>pattern</code>正则匹配时,在消费的时候依然可以指定一个确定的<code>topic</code>名称,此时会检查<code>pattern</code>是否匹配当前的<code>topic</code>,如不匹配则会报错</p></div> <h3 id="配置开始消费的位置"><a href="#配置开始消费的位置" class="header-anchor">#</a> 配置开始消费的位置</h3> <p>Flink Kafka Consumer 允许通过配置来确定 Kafka 分区的起始位置,<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/dev/connectors/kafka.html#kafka-consumers-start-position-configuration" target="_blank" rel="noopener noreferrer">官网文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>Kafka 分区的起始位置具体操作方式如下</p> <!----> <p>在<code>StreamX</code>中不推荐这种方式进行设定,提供了更方便的方式,只需要在配置里指定 <mark><code>auto.offset.reset</code></mark> 即可</p> <ul><li><code>earliest</code> 从最早的记录开始</li> <li><code>latest</code> 从最新的记录开始</li></ul> <h3 id="指定分区offset"><a href="#指定分区offset" class="header-anchor">#</a> 指定分区Offset</h3> <p>你也可以为每个分区指定 consumer 应该开始消费的具体 offset,只需要按照如下的配置文件配置<code>start.from</code>相关的信息即可</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">kafka.source</span><span class="token punctuation">:</span>
  <span class="token key atrule">bootstrap.servers</span><span class="token punctuation">:</span> kfk1<span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">,</span>kfk2<span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">,</span>kfk3<span class="token punctuation">:</span><span class="token number">9092</span>
  <span class="token key atrule">topic</span><span class="token punctuation">:</span> topic1<span class="token punctuation">,</span>topic2<span class="token punctuation">,</span>topic3<span class="token punctuation">...</span>
  <span class="token key atrule">group.id</span><span class="token punctuation">:</span> user_01
  <span class="token key atrule">auto.offset.reset</span><span class="token punctuation">:</span> earliest <span class="token comment"># (earliest | latest)</span>
  <span class="token key atrule">start.from</span><span class="token punctuation">:</span>
    <span class="token key atrule">timestamp</span><span class="token punctuation">:</span> <span class="token number">1591286400000</span> <span class="token comment">#指定timestamp,针对所有的topic生效</span>
    <span class="token key atrule">offset</span><span class="token punctuation">:</span> <span class="token comment"># 给topic的partition指定offset</span>
      <span class="token key atrule">topic</span><span class="token punctuation">:</span> topic_abc<span class="token punctuation">,</span>topic_123
      <span class="token key atrule">topic_abc</span><span class="token punctuation">:</span> 0<span class="token punctuation">:</span><span class="token number">182</span><span class="token punctuation">,</span>1<span class="token punctuation">:</span><span class="token number">183</span><span class="token punctuation">,</span>2<span class="token punctuation">:</span><span class="token number">182</span> <span class="token comment">#分区0从182开始消费,分区1从183开始,分区2从182开始...</span>
      <span class="token key atrule">topic_123</span><span class="token punctuation">:</span> 0<span class="token punctuation">:</span><span class="token number">182</span><span class="token punctuation">,</span>1<span class="token punctuation">:</span><span class="token number">183</span><span class="token punctuation">,</span>2<span class="token punctuation">:</span><span class="token number">182</span>
  <span class="token punctuation">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="指定deserializer"><a href="#指定deserializer" class="header-anchor">#</a> 指定deserializer</h3> <p>默认不指定<code>deserializer</code>则在内部采用String的方式反序列化topic中的数据,可以手动指定<code>deserializer</code>,这样可以一步直接返回目标<code>DataStream</code>,具体完整代码如下</p> <!----> <h3 id="返回记录kafkarecord"><a href="#返回记录kafkarecord" class="header-anchor">#</a> 返回记录KafkaRecord</h3> <p>返回的对象被包装在<code>KafkaRecord</code>中,<code>kafkaRecord</code>中有当前的<code>offset</code>,<code>partition</code>,<code>timestamp</code>等诸多有用的信息供开发者使用,其中<code>value</code>即返回的目标对象,如下图:</p> <p><img src="http://assets.streamxhub.com/1616492587158.jpg" alt=""></p> <h3 id="指定strategy"><a href="#指定strategy" class="header-anchor">#</a> 指定strategy</h3> <p>在许多场景中,记录的时间戳是(显式或隐式)嵌入到记录本身中。此外,用户可能希望定期或以不规则的方式<code>Watermark</code>,例如基于<code>Kafka</code>流中包含当前事件时间的<code>watermark</code>的特殊记录。对于这些情况，<code>Flink Kafka Consumer</code>是允许指定<code>AssignerWithPeriodicWatermarks</code>或<code>AssignerWithPunctuatedWatermarks</code></p> <p>在<code>StreamX</code>中运行传入一个<code>WatermarkStrategy</code>作为参数来分配<code>Watermark</code>,如下面的示例,解析<code>topic</code>中的数据为<code>user</code>对象,<code>user</code>中有个 <mark><code>orderTime</code></mark> 是时间类型,我们以这个为基准,为其分配一个<code>Watermark</code></p> <!----> <div class="custom-block info"><p class="custom-block-title">注意事项</p> <p>如果<code>watermark assigner</code>依赖于从<code>Kafka</code>读取的消息来上涨其<code>watermark</code>(通常就是这种情况),那么所有主题和分区都需要有连续的消息流。否则, <mark>整个应用程序的<code>watermark</code>将无法上涨</mark> ，所有基于时间的算子(例如时间窗口或带有计时器的函数)也无法运行。单个的<code>Kafka</code>分区也会导致这种反应。考虑设置适当的 <mark><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/dev/event_timestamps_watermarks.html#dealing-with-idle-sources" target="_blank" rel="noopener noreferrer"><code>idelness timeouts</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></mark> 来缓解这个问题。</p></div> <h2 id="kafka-sink-producer"><a href="#kafka-sink-producer" class="header-anchor">#</a> Kafka Sink (Producer)</h2> <p>在<code>StreamX</code>中<code>Kafka Producer</code> 被称为<code>KafkaSink</code>,它允许将消息写入一个或多个<code>Kafka topic中</code></p> <!----> <p><code>sink</code>是具体的写入数据的方法,参数列表如下</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">参数类型</th> <th style="text-align:left;">作用</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">必须</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>stream</code></td> <td style="text-align:left;">DataStream[T]</td> <td style="text-align:left;">要写的数据流</td> <td style="text-align:left;">无</td> <td style="text-align:left;"><i class="fa fa-check" style="color:green;"></i></td></tr> <tr><td style="text-align:left;"><code>alias</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;"><code>kafka</code>的实例别名</td> <td style="text-align:left;">无</td> <td style="text-align:left;"><i class="fa fa-times" style="color:red;"></i></td></tr> <tr><td style="text-align:left;"><code>serializationSchema</code></td> <td style="text-align:left;">SerializationSchema[T]</td> <td style="text-align:left;">写入的序列化器</td> <td style="text-align:left;">SimpleStringSchema</td> <td style="text-align:left;"><i class="fa fa-times" style="color:red;"></i></td></tr> <tr><td style="text-align:left;"><code>partitioner</code></td> <td style="text-align:left;">FlinkKafkaPartitioner[T]</td> <td style="text-align:left;">kafka分区器</td> <td style="text-align:left;">KafkaEqualityPartitioner[T]</td> <td style="text-align:left;"><i class="fa fa-times" style="color:red;"></i></td></tr></tbody></table> <h3 id="容错和语义"><a href="#容错和语义" class="header-anchor">#</a> 容错和语义</h3> <p>启用 Flink 的 <code>checkpointing</code> 后，<code>KafkaSink</code> 可以提供<code>精确一次</code>的语义保证,具体开启<code>checkpointing</code>的设置请参考第二章关于<a href="/doc/guide/quickstart/conf/#checkpoints">项目配置</a>部分</p> <p>除了启用 Flink 的 checkpointing，你也可以通过将适当的 <code>semantic</code> 参数传递给 <code>KafkaSink</code> 来选择三种不同的操作模式</p> <div class="counter"><ul><li>EXACTLY_ONCE  使用 Kafka 事务提供精确一次语义</li> <li>AT_LEAST_ONCE 至少一次,可以保证不会丢失任何记录(但是记录可能会重复)</li> <li>NONE Flink 不会有任何语义的保证，产生的记录可能会丢失或重复</li></ul></div> <p>具体操作如下,只需要在<code>kafka.sink</code>下配置<code>semantic</code>即可</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">kafka.sink</span><span class="token punctuation">:</span>
    <span class="token key atrule">bootstrap.servers</span><span class="token punctuation">:</span> kfk1<span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">,</span>kfk2<span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">,</span>kfk3<span class="token punctuation">:</span><span class="token number">9092</span>
    <span class="token key atrule">topic</span><span class="token punctuation">:</span> kfk_sink
    <span class="token key atrule">transaction.timeout.ms</span><span class="token punctuation">:</span> <span class="token number">1000</span>
    <span class="token key atrule">semantic</span><span class="token punctuation">:</span> AT_LEAST_ONCE <span class="token comment"># EXACTLY_ONCE|AT_LEAST_ONCE|NONE</span>
    <span class="token key atrule">batch.size</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">注意事项</p> <p><code>Semantic.EXACTLY_ONCE</code>模式依赖于事务提交的能力。事务提交发生于触发 checkpoint 之前，以及从 checkpoint 恢复之后。如果从 Flink 应用程序崩溃到完全重启的时间超过了 Kafka 的事务超时时间，那么将会有数据丢失（Kafka 会自动丢弃超出超时时间的事务）。考虑到这一点，请根据预期的宕机时间来合理地配置事务超时时间。</p> <p>默认情况下，Kafka broker 将 transaction.max.timeout.ms 设置为 15 分钟。此属性不允许为大于其值的 producer 设置事务超时时间。 默认情况下，FlinkKafkaProducer 将 producer config 中的 transaction.timeout.ms 属性设置为 1 小时，因此在使用 Semantic.EXACTLY_ONCE 模式之前应该增加 transaction.max.timeout.ms 的值。</p> <p>在 KafkaConsumer 的 read_committed 模式中，任何未结束（既未中止也未完成）的事务将阻塞来自给定 Kafka topic 的未结束事务之后的所有读取数据。 换句话说，在遵循如下一系列事件之后：</p> <div class="counter"><ul><li>用户启动了 transaction1 并使用它写了一些记录</li> <li>用户启动了 transaction2 并使用它编写了一些其他记录</li> <li>用户提交了 transaction2</li></ul></div> <p>即使 transaction2 中的记录已提交，在提交或中止 transaction1 之前，消费者也不会看到这些记录。这有 2 层含义：</p> <ul><li>首先，在 Flink 应用程序的正常工作期间，用户可以预料 Kafka 主题中生成的记录的可见性会延迟，相当于已完成 checkpoint 之间的平均时间。</li> <li>其次，在 Flink 应用程序失败的情况下，此应用程序正在写入的供消费者读取的主题将被阻塞，直到应用程序重新启动或配置的事务超时时间过去后，才恢复正常。此标注仅适用于有多个 agent 或者应用程序写入同一 Kafka 主题的情况。</li></ul> <p>注意：<code>Semantic.EXACTLY_ONCE</code> 模式为每个 FlinkKafkaProducer 实例使用固定大小的 KafkaProducer 池。每个 checkpoint 使用其中一个 producer。如果并发 checkpoint 的数量超过池的大小，FlinkKafkaProducer 将抛出异常，并导致整个应用程序失败。请合理地配置最大池大小和最大并发 checkpoint 数量。</p> <p>注意：<code>Semantic.EXACTLY_ONCE</code> 会尽一切可能不留下任何逗留的事务，否则会阻塞其他消费者从这个 Kafka topic 中读取数据。但是，如果 Flink 应用程序在第一次 checkpoint 之前就失败了，那么在重新启动此类应用程序后，系统中不会有先前池大小（pool size）相关的信息。因此，在第一次 checkpoint 完成前对 Flink 应用程序进行缩容，且并发数缩容倍数大于安全系数 FlinkKafkaProducer.SAFE_SCALE_DOWN_FACTOR 的值的话，是不安全的。</p></div> <h3 id="多实例kafka指定alias"><a href="#多实例kafka指定alias" class="header-anchor">#</a> 多实例kafka指定alias</h3> <p>如果写时有多个不同实例的kafka需要配置,同样采用<code>alias</code>来区别不用的kafka实例,配置如下:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">kafka.sink</span><span class="token punctuation">:</span>
    <span class="token key atrule">kafka_cluster1</span><span class="token punctuation">:</span>
        <span class="token key atrule">bootstrap.servers</span><span class="token punctuation">:</span> kfk1<span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">,</span>kfk2<span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">,</span>kfk3<span class="token punctuation">:</span><span class="token number">9092</span>
        <span class="token key atrule">topic</span><span class="token punctuation">:</span> kfk_sink
        <span class="token key atrule">transaction.timeout.ms</span><span class="token punctuation">:</span> <span class="token number">1000</span>
        <span class="token key atrule">semantic</span><span class="token punctuation">:</span> AT_LEAST_ONCE <span class="token comment"># EXACTLY_ONCE|AT_LEAST_ONCE|NONE</span>
        <span class="token key atrule">batch.size</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token key atrule">kafka_cluster2</span><span class="token punctuation">:</span>
        <span class="token key atrule">bootstrap.servers</span><span class="token punctuation">:</span> kfk6<span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">,</span>kfk7<span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">,</span>kfk8<span class="token punctuation">:</span><span class="token number">9092</span>
        <span class="token key atrule">topic</span><span class="token punctuation">:</span> kfk_sink
        <span class="token key atrule">transaction.timeout.ms</span><span class="token punctuation">:</span> <span class="token number">1000</span>
        <span class="token key atrule">semantic</span><span class="token punctuation">:</span> AT_LEAST_ONCE <span class="token comment"># EXACTLY_ONCE|AT_LEAST_ONCE|NONE</span>
        <span class="token key atrule">batch.size</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>在写入的时候,需要手动指定<code>alias</code>,注意下<code>scala</code> api和<code>java</code> api在代码上稍有不同,<code>scala</code>直接在<code>sink</code>方法里指定参数,<code>java</code> api则是通过<code>alias()</code>方法来设置,其底层实现是完全一致的</p> <!----> <h3 id="指定serializationschema"><a href="#指定serializationschema" class="header-anchor">#</a> 指定SerializationSchema</h3> <p><code>Flink Kafka Producer</code> 需要知道如何将 Java/Scala 对象转化为二进制数据。 KafkaSerializationSchema 允许用户指定这样的schema, 相关操作方式和文档请参考<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/dev/connectors/kafka.html#the-serializationschema" target="_blank" rel="noopener noreferrer">官网文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在<code>KafkaSink</code>里默认不指定序列化方式,采用的是<code>SimpleStringSchema</code>来进行序列化,这里开发者可以显示的指定一个自定义的序列化器,通过<code>serializationSchema</code>参数指定即可,例如,将<code>user</code>对象安装自定义的格式写入<code>kafka</code></p> <!----> <h3 id="指定partitioner"><a href="#指定partitioner" class="header-anchor">#</a> 指定partitioner</h3> <p><code>KafkaSink</code>允许显示的指定一个kafka分区器,不指定默认使用<code>StreamX</code>内置的 <mark>KafkaEqualityPartitioner</mark> 分区器,顾名思义,该分区器可以均匀的将数据写到各个分区中去,<code>scala</code> api是通过<code>partitioner</code>参数来设置分区器,
<code>java</code> api中是通过<code>partitioner()</code>方法来设置的</p> <div class="custom-block tip"><p class="custom-block-title">注意事项</p> <p>Flink Kafka Connector中默认使用的是 <mark>FlinkFixedPartitioner</mark> 分区器,该分区器需要特别注意<code>sink</code>的并行度和<code>kafka</code>的分区数,不然会出现往一个分区写</p></div></div> <footer class="page-meta theme-default-content"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/streamxhub/streamx/edit/main/doc/connector/kafka.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">December 20, 2021 11:56</span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/doc/model/model/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        编程模型
      </a></span> <span class="next"><a href="/doc/connector/jdbc/">
        Jdbc Connector
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <!----> </main> <footer class="footer-wrapper"><!----> <div class="footer">Apache LICENSE 2.0 Licensed</div> <div class="copyright">Copyright © 2019-2021 streamxhub.com</div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close (Esc)" class="pswp__button pswp__button--close"></button> <button title="Share" class="pswp__button pswp__button--share"></button> <button title="Toggle fullscreen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Previous (arrow left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (arrow right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.22cf09d4.js" defer></script><script src="/assets/js/layout-Layout.becd9ee4.js" defer></script><script src="/assets/js/layout-Blog~layout-Layout~layout-NotFound.3c755216.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.196cd7eb.js" defer></script><script src="/assets/js/vendors~layout-Layout.d4d9fba5.js" defer></script><script src="/assets/js/page-ApacheKafkaConnector.446746a8.js" defer></script>
  </body>
</html>
